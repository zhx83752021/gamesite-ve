# Vercel 部署步骤（一个项目部署前后端）

## ✅ 已完成的准备工作

1. ✅ 代码已推送到 GitHub: https://github.com/zhx83752021/gamesite-ve.git
2. ✅ 创建了 API Serverless Functions（`/api` 目录）
3. ✅ 配置了 `vercel.json` 实现前后端路由
4. ✅ 数据库配置已支持 Vercel Postgres
5. ✅ Redis 配置已支持 Upstash

## 📋 在 Vercel 上部署

### 方法 1：通过 Vercel 网站（推荐，最简单）

1. **访问 Vercel**

   - 打开 https://vercel.com/
   - 使用 GitHub 账号登录

2. **导入项目**

   - 点击 "Add New..." → "Project"
   - 选择 "Import Git Repository"
   - 找到并选择 `zhx83752021/gamesite-ve` 仓库

3. **配置项目（重要）**

   ```
   Project Name: gamesite-ve
   Framework Preset: Other（保持默认）
   Root Directory: / （根目录，不要选择子目录）
   Build Command: 保持默认
   Output Directory: 保持默认
   Install Command: npm install
   ```

4. **配置环境变量**（在部署前添加）

   点击 "Environment Variables"，添加以下变量：

   **必需的数据库配置：**

   ```
   POSTGRES_URL=postgresql://用户名:密码@主机:端口/数据库名
   ```

   **JWT 配置：**

   ```
   JWT_SECRET=your_secret_key_at_least_32_characters_long
   JWT_EXPIRES_IN=7d
   ```

   **其他配置：**

   ```
   NODE_ENV=production
   FRONTEND_URL=https://gamesite-ve.vercel.app
   ```

5. **点击 Deploy**
   - Vercel 会自动检测配置并开始构建
   - 等待 3-5 分钟完成部署

### 方法 2：通过 Vercel CLI

```bash
# 确保已登录
vercel login

# 在项目根目录执行
vercel --prod

# 按提示操作
```

## 🗄️ 数据库设置

### 选项 1：使用 Vercel Postgres（推荐）

1. 在 Vercel 项目页面，点击 "Storage"
2. 点击 "Create Database" → 选择 "Postgres"
3. Vercel 会自动创建数据库并添加环境变量
4. 连接到数据库执行初始化脚本：
   ```bash
   # 从 backend/database/ 目录执行 SQL 脚本
   ```

### 选项 2：使用外部数据库（Supabase/Neon/Railway）

使用你现有的 PostgreSQL 数据库，只需在 Vercel 环境变量中配置 `POSTGRES_URL`

## 🔧 可选：Redis 缓存（提升性能）

1. 注册 Upstash: https://upstash.com/
2. 创建 Redis 数据库
3. 在 Vercel 环境变量中添加：
   ```
   UPSTASH_REDIS_REST_URL=你的Redis URL
   UPSTASH_REDIS_REST_TOKEN=你的Redis Token
   ```

## ✅ 验证部署

部署完成后访问：

- **前端首页**: https://gamesite-ve.vercel.app
- **API 根路径**: https://gamesite-ve.vercel.app/api/v1
- **健康检查**: https://gamesite-ve.vercel.app/health

API 接口示例：

```
GET  https://gamesite-ve.vercel.app/api/v1/games
POST https://gamesite-ve.vercel.app/api/v1/auth/login
GET  https://gamesite-ve.vercel.app/api/v1/users/profile
```

## 🔍 常见问题

### 1. 部署失败怎么办？

- 检查 Vercel 部署日志（Deployments → 查看详情）
- 确认环境变量配置正确
- 检查 GitHub 代码是否最新

### 2. API 404 错误

- 确认 `vercel.json` 路由配置正确
- 检查 API 路径是否正确（必须以 `/api` 开头）

### 3. 数据库连接失败

- 确认 `POSTGRES_URL` 配置正确
- 检查数据库是否允许外部连接
- 验证数据库用户权限

### 4. 环境变量不生效

- 重新部署项目（修改环境变量后需要重新部署）
- 检查变量名是否正确（区分大小写）

## 📚 更多文档

详细部署文档请查看：`VERCEL_DEPLOY.md`

## 🎯 Root Directory 说明

**Root Directory: `/` （根目录）**

这是关键配置！因为：

- 前端在 `frontend/` 目录
- 后端 API 在 `api/` 目录
- `vercel.json` 在根目录，负责路由分发

Vercel 会根据 `vercel.json` 自动：

1. 构建前端（frontend → dist）
2. 构建后端 API（api → serverless functions）
3. 配置路由（/api/_ → API，/_ → 前端）

**不要选择 frontend 或 backend 作为 Root Directory！**
