# æ•°æ®åº“è¿ç§»æ–‡æ¡£

## ğŸ“ æ–‡ä»¶è¯´æ˜

- **schema.sql** - æ•°æ®åº“ç»“æ„åˆå§‹åŒ–è„šæœ¬ï¼ˆ17 å¼ è¡¨ï¼‰
- **seed.sql** - æµ‹è¯•æ•°æ®å¡«å……è„šæœ¬
- **migrate.ts** - æ•°æ®åº“è¿ç§»æ‰§è¡Œå·¥å…·ï¼ˆTypeScriptï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `backend` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# PostgreSQL æ•°æ®åº“è¿æ¥
DATABASE_URL=postgresql://username:password@localhost:5432/vr_game_platform

# æˆ–ä½¿ç”¨äº‘æ•°æ®åº“ï¼ˆå¦‚ Neon, Supabase ç­‰ï¼‰
# DATABASE_URL=postgresql://user:pass@host.region.provider.com:5432/dbname
```

### 2. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»

#### é¦–æ¬¡å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# å…¨æ–°å®‰è£…ï¼šé‡ç½® + åˆå§‹åŒ– + å¡«å……æµ‹è¯•æ•°æ®
npm run db:fresh
```

#### åˆ†æ­¥æ‰§è¡Œ

```bash
# 1. åªåˆå§‹åŒ–æ•°æ®åº“ç»“æ„
npm run db:init

# 2. åªå¡«å……æµ‹è¯•æ•°æ®
npm run db:seed

# 3. é‡ç½®æ•°æ®åº“ï¼ˆåˆ é™¤æ‰€æœ‰è¡¨ï¼‰
npm run db:reset
```

## ğŸ“Š æ•°æ®åº“ç»“æ„

### 17 å¼ æ•°æ®è¡¨

1. **users** - ç”¨æˆ·è¡¨
2. **categories** - æ¸¸æˆåˆ†ç±»è¡¨
3. **games** - æ¸¸æˆè¡¨
4. **tags** - æ ‡ç­¾è¡¨
5. **game_tags** - æ¸¸æˆ-æ ‡ç­¾å…³è”è¡¨
6. **game_media** - æ¸¸æˆåª’ä½“ï¼ˆæˆªå›¾/è§†é¢‘ï¼‰è¡¨
7. **comments** - è¯„è®ºè¡¨
8. **comment_replies** - è¯„è®ºå›å¤è¡¨
9. **user_game_library** - ç”¨æˆ·æ¸¸æˆåº“è¡¨
10. **orders** - è®¢å•è¡¨
11. **order_items** - è®¢å•é¡¹è¡¨
12. **forum_sections** - è®ºå›æ¿å—è¡¨
13. **posts** - å¸–å­è¡¨
14. **post_replies** - å¸–å­å›å¤è¡¨
15. **friendships** - å¥½å‹å…³ç³»è¡¨
16. **notifications** - é€šçŸ¥è¡¨
17. **reports** - ä¸¾æŠ¥è¡¨

### ER å…³ç³»å›¾

```
ç”¨æˆ·(User) 1 --- N æ¸¸æˆ(Game) [å¼€å‘å…³ç³»]
ç”¨æˆ·(User) 1 --- N è®¢å•(Order)
ç”¨æˆ·(User) 1 --- N è¯„è®º(Comment)
ç”¨æˆ·(User) 1 --- N å¸–å­(Post)
ç”¨æˆ·(User) N --- N ç”¨æˆ·(User) [å¥½å‹å…³ç³»]
ç”¨æˆ·(User) N --- N æ¸¸æˆ(Game) [æ¸¸æˆåº“]

æ¸¸æˆ(Game) 1 --- N è¯„è®º(Comment)
æ¸¸æˆ(Game) 1 --- N æ¸¸æˆåª’ä½“(GameMedia)
æ¸¸æˆ(Game) N --- N æ ‡ç­¾(Tag)
æ¸¸æˆ(Game) N --- 1 åˆ†ç±»(Category)

è®¢å•(Order) 1 --- N è®¢å•é¡¹(OrderItem)
å¸–å­(Post) 1 --- N å›å¤(PostReply)
å¸–å­(Post) N --- 1 è®ºå›æ¿å—(ForumSection)
```

## ğŸ§ª æµ‹è¯•æ•°æ®

æ‰§è¡Œ `seed.sql` åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

### æµ‹è¯•è´¦æˆ·

| è§’è‰²       | ç”¨æˆ·å     | å¯†ç       | é‚®ç®±              |
| ---------- | ---------- | --------- | ----------------- |
| ç®¡ç†å‘˜     | admin      | Admin123! | admin@vrgame.com  |
| å¼€å‘è€… 1   | developer1 | Dev123!   | dev1@vrgame.com   |
| å¼€å‘è€… 2   | developer2 | Dev123!   | dev2@vrgame.com   |
| æ™®é€šç”¨æˆ· 1 | user1      | User123!  | user1@example.com |
| æ™®é€šç”¨æˆ· 2 | user2      | User123!  | user2@example.com |
| æ™®é€šç”¨æˆ· 3 | user3      | User123!  | user3@example.com |
| ç‰ˆä¸»       | moderator1 | Mod123!   | mod1@vrgame.com   |

### æµ‹è¯•æ•°æ®ç»Ÿè®¡

- **ç”¨æˆ·**: 7 ä¸ª
- **æ¸¸æˆåˆ†ç±»**: 8 ä¸ª
- **æ ‡ç­¾**: 10 ä¸ª
- **æ¸¸æˆ**: 5 ä¸ª
  - VR æˆ˜æ–—å…ˆé”‹ï¼ˆå°„å‡»æ¸¸æˆï¼‰
  - è°œå¢ƒæ¢ç´¢ï¼ˆè§£è°œæ¸¸æˆï¼‰
  - èŠ‚å¥ä¹‹æ˜Ÿï¼ˆéŸ³ä¹æ¸¸æˆï¼‰
  - å¥èº«è¾¾äºº VRï¼ˆå¥èº«åº”ç”¨ï¼‰
  - ææ€–åŒ»é™¢ï¼ˆææ€–æ¸¸æˆï¼‰
- **è¯„è®º**: 5 æ¡
- **è®ºå›æ¿å—**: 5 ä¸ª
- **å¸–å­**: 4 ä¸ª
- **è®¢å•**: 3 ä¸ª

## ğŸ› ï¸ æ‰‹åŠ¨æ‰§è¡Œ SQL

å¦‚æœä½ æƒ³ç›´æ¥ä½¿ç”¨ SQL æ–‡ä»¶ï¼ˆä¸é€šè¿‡ TypeScript å·¥å…·ï¼‰ï¼š

### ä½¿ç”¨ psql å‘½ä»¤è¡Œ

```bash
# 1. è¿æ¥åˆ°æ•°æ®åº“
psql -h localhost -U username -d vr_game_platform

# 2. æ‰§è¡Œschema
\i backend/database/schema.sql

# 3. æ‰§è¡Œseed
\i backend/database/seed.sql
```

### ä½¿ç”¨ pg å®¢æˆ·ç«¯å·¥å…·

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å¯è§†åŒ–å·¥å…·å¦‚ pgAdmin, DBeaver ç­‰ï¼š

1. æ‰“å¼€ `schema.sql`
2. åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œ
3. æ‰“å¼€ `seed.sql`
4. åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œ

## ğŸ“ å¸¸è§é—®é¢˜

### Q: DATABASE_URL æ ¼å¼æ˜¯ä»€ä¹ˆï¼Ÿ

A: `postgresql://ç”¨æˆ·å:å¯†ç @ä¸»æœº:ç«¯å£/æ•°æ®åº“å`

ç¤ºä¾‹ï¼š

```
postgresql://postgres:password@localhost:5432/vr_game_platform
```

### Q: å¦‚ä½•è¿æ¥äº‘æ•°æ®åº“ï¼Ÿ

A: å„å¤§äº‘æœåŠ¡å•†éƒ½æä¾› PostgreSQL æ•°æ®åº“ï¼š

- **Neon**: https://neon.tech (æ¨èï¼Œå…è´¹é¢åº¦å¤§)
- **Supabase**: https://supabase.com (å…è´¹æœ‰é¢åº¦)
- **Railway**: https://railway.app
- **Render**: https://render.com

æ³¨å†Œåè·å–è¿æ¥å­—ç¬¦ä¸²ï¼Œè®¾ç½®åˆ° `DATABASE_URL` å³å¯ã€‚

### Q: æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. ç¡®è®¤ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` é…ç½®æ­£ç¡®
2. ç¡®è®¤æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ
3. ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æƒé™
4. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸ä¼šæç¤ºå…·ä½“é—®é¢˜

### Q: å¦‚ä½•æ¸…ç©ºæ•°æ®ä½†ä¿ç•™è¡¨ç»“æ„ï¼Ÿ

A: ä½¿ç”¨ TRUNCATE å‘½ä»¤ï¼š

```sql
TRUNCATE TABLE users, games, comments, posts, orders CASCADE;
```

æˆ–è€…æ‰§è¡Œï¼š

```bash
npm run db:reset  # åˆ é™¤æ‰€æœ‰è¡¨
npm run db:init   # é‡æ–°åˆ›å»ºè¡¨ç»“æ„
```

### Q: ç”Ÿäº§ç¯å¢ƒå¦‚ä½•ä½¿ç”¨ï¼Ÿ

A: ç”Ÿäº§ç¯å¢ƒ**ä¸è¦**æ‰§è¡Œ `seed.sql`ï¼ˆæµ‹è¯•æ•°æ®ï¼‰ï¼Œåªæ‰§è¡Œ `schema.sql`ï¼š

```bash
# ä»…åˆå§‹åŒ–è¡¨ç»“æ„
npm run db:init
```

æˆ–è€…åœ¨ç”Ÿäº§æ•°æ®åº“ä¸­æ‰‹åŠ¨æ‰§è¡Œ `schema.sql`ã€‚

## ğŸ”’ å®‰å…¨æç¤º

1. **ä¸è¦**åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æµ‹è¯•æ•°æ®ä¸­çš„å¯†ç 
2. **ä¸è¦**å°† `.env` æ–‡ä»¶æäº¤åˆ° Git ä»“åº“
3. **å®šæœŸå¤‡ä»½**ç”Ÿäº§æ•°æ®åº“
4. ä½¿ç”¨**å¼ºå¯†ç **ä¿æŠ¤æ•°æ®åº“
5. é™åˆ¶æ•°æ®åº“**è®¿é—®æƒé™**

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PostgreSQL å®˜æ–¹æ–‡æ¡£](https://www.postgresql.org/docs/)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../../docs/05-æ•°æ®åº“è®¾è®¡.md)
- [API æ¥å£æ–‡æ¡£](../../docs/06-APIæ¥å£æ–‡æ¡£.md)

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

1. é¡¹ç›®æ–‡æ¡£ï¼š`docs/` ç›®å½•
2. æ•°æ®åº“æ—¥å¿—ï¼šæ£€æŸ¥ PostgreSQL æ—¥å¿—
3. æäº¤ Issueï¼šåœ¨ GitHub ä¸Šæäº¤é—®é¢˜

---

**æœ€åæ›´æ–°**: 2024-12-02
