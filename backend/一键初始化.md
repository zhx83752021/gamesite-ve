# 🚀 一键初始化指南（Node.js v22 版本）

## ✅ 已完成的步骤

1. ✅ **bcrypt 已替换为 bcryptjs**（支持 Node.js v22）
2. ✅ **npm 依赖已安装**（241 个包）

## 📝 剩余步骤

### 步骤 1：创建 .env 配置文件

在 `backend` 目录创建 `.env` 文件（注意：没有文件名，只有扩展名）

**方法 A：复制模板文件**

```bash
复制 .env.template 为 .env
```

**方法 B：手动创建**
在 `backend` 目录新建文本文件，命名为 `.env`（删除 .txt 扩展名），内容：

```env
NODE_ENV=development
PORT=5000

# 重要！修改密码为你的 PostgreSQL 密码
DATABASE_URL=postgresql://postgres:你的密码@localhost:5432/vr_game_platform

JWT_SECRET=local-dev-secret-key
JWT_REFRESH_SECRET=local-dev-refresh-key
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

FRONTEND_URL=http://localhost:3000
```

**⚠️ 重要**：将 `你的密码` 替换为你实际的 PostgreSQL 密码！

**如果密码中有特殊字符**，需要进行 URL 编码：

- `@` → `%40`
- `#` → `%23`
- `&` → `%26`
- `/` → `%2F`

例如：密码是 `Admin@123` → `Admin%40123`

### 步骤 2：在 pgAdmin 中创建数据库

打开 **pgAdmin** → 连接到 **PostgreSQL** → 打开 **Query Tool**

执行以下 SQL：

```sql
CREATE DATABASE vr_game_platform
    WITH
    OWNER = postgres
    ENCODING = 'UTF8'
    CONNECTION LIMIT = -1;
```

或者右键 "Databases" → "Create" → "Database" → 输入名称 `vr_game_platform` → Save

### 步骤 3：初始化数据库（创建 17 张表）

在 `backend` 目录打开终端（PowerShell 或 CMD），执行：

```bash
npm run db:fresh
```

这会自动：

- 创建 17 张数据表
- 填充测试数据（7 个用户、5 个游戏等）
- 设置初始数据

**预期输出**：

```
✅ 数据库连接成功
✅ 开始执行数据库重置...
✅ 所有表已删除
✅ 开始创建表...
✅ 创建表 users 成功
✅ 创建表 categories 成功
...（共 17 张表）
✅ 数据库初始化成功！
```

### 步骤 4：启动后端服务

```bash
npm run dev
```

**预期输出**：

```
🚀 服务器运行在 http://localhost:5000
✅ 数据库连接成功
```

### 步骤 5：测试接口

浏览器访问：http://localhost:5000/api/health

应该看到：

```json
{
  "status": "ok",
  "timestamp": "2025-12-04T01:40:00.000Z"
}
```

## 🎮 测试账户

| 用户名     | 密码      | 角色     |
| ---------- | --------- | -------- |
| admin      | Admin123! | 管理员   |
| developer1 | Dev123!   | 开发者   |
| user1      | User123!  | 普通用户 |

## ❓ 常见问题

### Q1：DATABASE_URL 连接失败？

**检查清单**：

1. ✅ PostgreSQL 服务是否运行？（任务管理器查看）
2. ✅ 数据库 `vr_game_platform` 是否已创建？
3. ✅ 密码是否正确？（注意大小写）
4. ✅ 端口是否是 5432？

### Q2：.env 文件不生效？

确保：

- 文件名是 `.env`（不是 `.env.txt`）
- 文件在 `backend` 目录下
- DATABASE_URL 没有空格或换行

### Q3：npm run db:fresh 报错？

**常见错误**：

- `DATABASE_URL 环境变量未设置` → 检查 .env 文件
- `数据库不存在` → 先在 pgAdmin 中创建数据库
- `连接超时` → 检查 PostgreSQL 服务是否启动

### Q4：如何重置数据库？

```bash
npm run db:fresh  # 删除所有数据并重新初始化
```

## 🎯 快速检查命令

```bash
# 检查 Node 版本
node --version

# 检查 bcryptjs 是否安装
npm list bcryptjs

# 检查环境变量是否加载
npm run dev
# 应该看到数据库连接成功
```

## 📞 需要帮助？

如果遇到问题，请提供：

1. 错误信息截图
2. `.env` 文件内容（隐藏密码）
3. pgAdmin 中数据库列表截图
