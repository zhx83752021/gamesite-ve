# 本地环境配置步骤

## 第一步：创建数据库

在 pgAdmin 中执行（Query Tool）：

```sql
CREATE DATABASE vr_game_platform
    WITH
    OWNER = postgres
    ENCODING = 'UTF8'
    CONNECTION LIMIT = -1;
```

## 第二步：创建 .env 配置文件

在 `backend` 目录下创建 `.env` 文件，内容如下：

```env
# 环境配置
NODE_ENV=development
PORT=5000

# 数据库配置（本地开发）- 请修改密码为你的 PostgreSQL 密码
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=你的PostgreSQL密码
DB_NAME=vr_game_platform

# JWT密钥
JWT_SECRET=local-dev-secret-key-change-in-production
JWT_REFRESH_SECRET=local-dev-refresh-key-change-in-production
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# 前端URL
FRONTEND_URL=http://localhost:3000

# Redis配置（可选）
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# 文件上传
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=52428800
```

**重要**：将 `你的PostgreSQL密码` 替换为你实际的密码！

## 第三步：修复 bcrypt 安装问题

### 方法 1：使用自动修复脚本（推荐）

直接双击运行 `fix-bcrypt.bat` 文件

### 方法 2：手动执行命令

在 backend 目录打开 PowerShell，执行：

```powershell
# 清理旧的安装
Remove-Item -Recurse -Force node_modules -ErrorAction SilentlyContinue
Remove-Item package-lock.json -ErrorAction SilentlyContinue

# 清理缓存
npm cache clean --force

# 重新安装
npm install --legacy-peer-deps
```

### 方法 3：如果仍然失败，安装 Windows 构建工具

```powershell
# 以管理员身份运行 PowerShell，然后执行：
npm install -g windows-build-tools
```

等待完成后，再执行：

```powershell
npm install --legacy-peer-deps
```

## 第四步：初始化数据库

安装成功后，运行：

```bash
npm run db:fresh
```

这会自动创建 17 张表并填充测试数据。

## 第五步：启动开发服务器

```bash
npm run dev
```

服务器会在 http://localhost:5000 启动

## 测试账户

| 用户名     | 密码      | 角色     |
| ---------- | --------- | -------- |
| admin      | Admin123! | 管理员   |
| developer1 | Dev123!   | 开发者   |
| user1      | User123!  | 普通用户 |

## 常见问题

### Q: bcrypt 仍然安装失败怎么办？

A: 可以尝试：

1. 确保 Node.js 版本在 v18-v20 之间（v22 可能不兼容）
2. 使用 nvm 切换 Node 版本：`nvm install 20` 然后 `nvm use 20`
3. 如果实在不行，可以考虑使用 bcryptjs 替代（性能略低但不需要编译）

### Q: 数据库连接失败？

A: 检查：

1. PostgreSQL 服务是否运行
2. .env 中的密码是否正确
3. 数据库名称是否为 `vr_game_platform`
4. 端口是否为 5432
